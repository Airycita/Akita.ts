"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AkitaClient=void 0;const tslib_1=require("tslib"),member_remove_1=tslib_1.__importDefault(require("../handlers/member_remove")),member_add_1=tslib_1.__importDefault(require("../handlers/member_add")),interaction_1=tslib_1.__importDefault(require("../handlers/interaction")),interpreter_1=require("./interpreter"),message_1=tslib_1.__importDefault(require("../handlers/message")),midou_ts_1=require("midou.ts"),discord_js_1=require("discord.js");class AkitaClient extends discord_js_1.Client{timeouts=new midou_ts_1.Timeouts({restore:!0});interpreter=new interpreter_1.Interpreter;prefixes=null;cbs={};commands=[];constructor(e,r){super(e),this.prefixes=Array.isArray(r)?r:[r],this.timeouts.on("expires",async e=>{await this.resolve(e.data.code,{metadata:{vars:e.data.data}},this)}),this.timeouts.start(),this.on("ready",e=>{this.interpreter.parse("$log[DEBUG;Bot Ready as $data[client;user;tag]!!]",void 0,e),setTimeout(()=>this.isReady()||console.log("CLIENT CAN NOT START!".bgRed),1e4)}),this.on("functionError",(e,r)=>{console.log(`${"InternalError".bgRed} ${"in".gray} ${(r.func?.total||"unknown").bgRed}:
    ${">".gray} `+(e.stack||"Without Stack").gray)})}async resolve(e,r,t=this){return this.interpreter.parse(e,r,t)}readyCommand(e){return this.on("ready",()=>{this.resolve(e,void 0,this)})}onFunctionError(t){return this.removeAllListeners("functionError"),this.on("functionError",(e,r)=>{r.metadata.vars.error=e,this.resolve(t,r,this)})}onGuildMemberAdd(){return this.on("guildMemberAdd",e=>{(0,member_add_1.default)(e,this)})}onGuildMemberRemove(){return this.on("guildMemberRemove",e=>{(0,member_remove_1.default)(e,this)})}onMessageCreate(r){return this.on("messageCreate",e=>{(0,message_1.default)(e,this,r)})}onInteractionCreate(){return this.on("interactionCreate",e=>{(0,interaction_1.default)(e,this)})}addCommand({names:e,type:r,code:t}){return this.commands.push({names:Array.isArray(e)?e:[e],type:r,code:t}),this}getCommands(r){return this.commands.find(e=>e.names?.includes(r))}addCallback(e,r){this.cbs[e]=r}}exports.AkitaClient=AkitaClient;