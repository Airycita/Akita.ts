"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compiler=void 0,String.prototype.replaceLast=function(e,t){var s;return(e="string"==typeof e?e:(this.match(e)||[]).slice(-1)[0])&&-1!==(s=this.lastIndexOf(e))?""+this.slice(0,s)+t+this.slice(s+e.length):this};class Compiler{_matched=null;matched=null;functions=[];regex=null;result="";code;constructor(e){this.code=e}set_functions(e){return e=e.sort((e,t)=>t.length-e.length),this.functions=e,this.regex=new RegExp(`(${e.map(e=>e.replace("$","\\$")).join("|")})`,"g"),this}set_code(e){return this.code=e}match(){if(this.regex&&this.code){let c={},d=this.code;Array.from(this.code.matchAll(this.regex)).reverse()?.map((i,l)=>{var r=d.split(i[0]).slice(-1).join(""),l="FUNCTION_"+l;if(r.startsWith("[")){let e="",t=0,s;for(const o of r.slice(1)){if("]"==o&&t<=0)break;"["==o?(e+=o,t++):"]"==o&&0<t?(e+=o,t--):e+=o}s=`${i[0]}[${e}]`,c[l]={resolve_fields:()=>{},resolve_field:()=>{},fields:e.split(";").map(e=>({value:e.trim(),overs:[]})),name:i[0],inside:e,total:s,id:l},d=d.replaceLast(s,l)}else c[l]={resolve_fields:()=>{},resolve_field:()=>{},fields:null,inside:null,total:i[0],name:i[0],id:l},d=d.replaceLast(i[0],l)});const i=this._matched=c,e=Object.values(c);return e.forEach(s=>{if(s.inside&&s.fields)return e.some(e=>e.fields?.some(e=>e.overs.some(e=>e.id==s.id)))?delete c[s.id]:void s.fields.forEach((e,t)=>{e.value.match(/FUNCTION_\d+/g)?.forEach(e=>{i[e]&&(c[s.id].fields[t].overs.push(i[e]),delete c[e])})})}),this.result=d,this.matched=c}}}exports.Compiler=Compiler;